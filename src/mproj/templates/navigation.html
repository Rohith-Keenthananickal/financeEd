<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"> -->
    <link href="{% static 'assets/css/nav.css' %}" rel="stylesheet">
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>


    <title>Document</title>
</head>
<body style="background-color: black;">
    
    <nav class="navbar navbar-expand-lg navbar-bg-grey fixed-top">
        <div class="container-fluid justify-content-end">
            <a class="navbar-brand" href="#">
                <span class="logo-text">Financ<span class="logo-letter">E</span>d</span>
            </a>

            <button class="navbar-toggler toggle-sidebar-btn " type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon" style="color:gold"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-center" id="navbarSupportedContent">
            <ul class="navbar-nav">
            <li class="nav-item">
            <a class="nav-link active" aria-current="page" href={% url "index" %} target="_parent">Home</a>
            </li>
            <li class="nav-item">
            <a class="nav-link" href="#about" target="_parent">About</a>
            </li>
            <li class="nav-item">
            <a class="nav-link" href="#learn" target="_parent">Learn</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'post_list' %}" target="_parent">Social</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="{% url 'chat' %}" target="_parent">Messages</a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="{% url 'chatbot' %}" target="_parent">Chatbot</a>
            </li>
            </ul>
             
            </div>
        </div>
        </div>
        <div>
            <div class="navbar-nav flex-row order-md-last" style="margin-right: 20px ;">
                            
                <div class="nav-item dropdown">
                    <a href="#" class="nav-link d-flex lh-1 text-reset p-0" data-bs-toggle="dropdown" aria-label="Open user menu">
                    <span class="avatar avatar-sm rounded-circle" style="background-image: url('https://preview.tabler.io/static/photos/young-entrepreneur-working-from-a-modern-cafe.jpg')"></span>
                    <div class="d-block ps-2 fs-4">
                        <div class="text-white userName" style="text-transform: capitalize;"></div>
                        <div class="mt-1 text-green user-role" style="text-transform: capitalize;"></div>
                    </div>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                    <!-- <a href="#" class="dropdown-item">Status</a> -->
                    <a class="dropdown-item" href="{% url 'profile' %}" target="_parent">Profile</a>
                    <!-- <a href="#" class="dropdown-item">Feedback</a> -->
                    <div class="dropdown-divider"></div>
                    <!-- <a href="./settings.html" class="dropdown-item">Settings</a> -->
                    <a class="dropdown-item" id="logout" target="_parent">Logout</a>
                    </div>
                </div>
            </div>
            <script>
                $(document).ready(function() {
                    let currentUserId = JSON.parse(localStorage.getItem('currentUser')).id;
                    
                    function getCookie(name) {
                        let cookieValue = null;
                        if (document.cookie && document.cookie !== '') {
                            const cookies = document.cookie.split(';');
                            for (let i = 0; i < cookies.length; i++) {
                                const cookie = cookies[i].trim();
                                // Does this cookie string begin with the name we want?
                                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                    break;
                                }
                            }
                        }
                        return cookieValue;
                    }
                    const csrftoken = getCookie('csrftoken');
                    
                    function getCsrfToken() {
                        return getCookie('csrftoken') || document.querySelector('meta[name="csrf-token"]').getAttribute('content');
                    }
                    
        
                    $.ajaxSetup({
                        beforeSend: function(xhr, settings) {
                            if (!(/^GET|HEAD|OPTIONS|TRACE$/i.test(settings.type))) {
                                xhr.setRequestHeader("X-CSRFToken", getCsrfToken());
                            }
                        }
                    });
                    function getCurrentUserInfo(){
                        $.ajax({
                            type: 'POST',
                            url: "http://127.0.0.1:8000/api/socialmedia/user/info",
                            data: {
                                'userId': currentUserId,
                            },
                            success: function(response) {
                                console.log(response);
                                $(".userName").html(response.user.username)
                                $(".user-role").html(response.user.role)
                                // $("#following").html(response.following_count)
                                // $("#suggested-users").html(nonFolloing_users)
                            },
                            error: function(xhr, status, error) {
                                console.error('Error:', error);
                            }
                        });
                    }
        
                    getCurrentUserInfo()
        
                    $("#logout").on("click",function(){
                        localStorage.removeItem('currentUser');
                        window.location.href = '/signup';
                    })
                })
            </script>
        </div>
        
    </nav>
    
</body>
</html>